# 🚀 نظام مازوني - النظام الحقيقي 100%

## 🎯 نظرة عامة

نظام مازوني هو موقع عربي إسلامي **يعمل 100% مع قاعدة البيانات الحقيقية** بدون أي بيانات وهمية أو للتجربة. النظام مصمم ليكون آمناً ومستقراً ومتاحاً للإنتاج مباشرة.

## ✨ الميزات الرئيسية

### 🔐 نظام المصادقة الكامل
- تسجيل دخول آمن مع قاعدة البيانات
- إعادة تعيين كلمات المرور عبر البريد الإلكتروني
- إدارة المستخدمين والأدوار
- حماية كاملة من الهجمات

### 🏙️ إدارة المدن والشيوخ
- إضافة وتعديل المدن
- إدارة الشيوخ والمعلومات الشخصية
- نظام مراجعات متكامل
- بحث وتصفية متقدمة

### 📧 نظام البريد الإلكتروني
- إرسال آلي للرسائل
- استعادة كلمات المرور
- إشعارات النظام
- تصميم عربي احترافي

### 🎨 واجهة مستخدم إسلامية
- تصميم بسيط بدون تدرجات أو رسوم متحركة
- نمط عربي إسلامي أصيل
- متجاوب مع جميع الأجهزة
- سهولة الاستخدام

## 🏗️ المتطلبات التقنية

### قاعدة البيانات
- **MongoDB Atlas** أو خادم MongoDB محلي
- **مطلوب بشكل إجباري** - لا يمكن تشغيل النظام بدونه
- اتصال آمن مع SSL/TLS

### البريد الإلكتروني
- **Gmail SMTP** أو أي مزود SMTP آخر
- كلمة مرور تطبيق صحيحة
- إعدادات SMTP صحيحة

### البيئة
- **Node.js 18+**
- **Next.js 15**
- **TypeScript**
- متغيرات بيئة صحيحة

## ⚙️ الإعداد

### 1. متغيرات البيئة
```bash
# قاعدة البيانات (مطلوب)
MONGODB_URI=mongodb+srv://username:password@cluster.mongodb.net/database

# البريد الإلكتروني (مطلوب)
EMAIL_USER=your-email@gmail.com
EMAIL_APP_PASSWORD=your-app-password
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587

# الأمان
JWT_SECRET=your-super-secret-jwt-key
NEXTAUTH_URL=http://localhost:3000
```

### 2. تثبيت التبعيات
```bash
npm install
```

### 3. إعداد قاعدة البيانات
```bash
# إنشاء المستخدمين الأوليين
npm run init-database

# أو استخدام MongoDB Compass/Atlas مباشرة
```

### 4. تشغيل النظام
```bash
npm run dev
```

## 🔒 الأمان

### حماية البيانات
- تشفير كلمات المرور بـ bcrypt
- رموز JWT آمنة
- حماية من SQL Injection
- حماية من XSS

### حماية المستخدمين
- منع Email Enumeration
- حماية من Brute Force
- تتبع محاولات الفشل
- صلاحيات محدودة

### حماية النظام
- HTTPS إجباري
- Headers أمنية
- Rate Limiting
- Logging آمن

## 📊 قاعدة البيانات

### المجموعات الرئيسية
```javascript
// المستخدمين
users: {
  _id, email, password, name, role, permissions, isActive, createdAt, updatedAt
}

// المدن
cities: {
  _id, name, slug, description, image, sheikhCount, createdAt, updatedAt
}

// الشيوخ
sheikhs: {
  _id, name, email, phone, city, bio, image, isActive, createdAt, updatedAt
}

// رموز إعادة التعيين
resetTokens: {
  _id, userId, email, token, expiresAt, createdAt
}
```

### الفهارس
- فهرس فريد على البريد الإلكتروني
- فهرس على المدينة
- فهرس على تاريخ الإنشاء
- فهرس على حالة النشاط

## 🚀 النشر

### Vercel (موصى به)
```bash
# إعداد Vercel
vercel --prod

# أو رفع الكود مباشرة
git push origin main
```

### خادم VPS
```bash
# بناء المشروع
npm run build

# تشغيل الإنتاج
npm start
```

### Docker
```dockerfile
FROM node:18-alpine
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production
COPY . .
RUN npm run build
EXPOSE 3000
CMD ["npm", "start"]
```

## 🧪 الاختبار

### اختبار قاعدة البيانات
```bash
# اختبار الاتصال
npm run test-db

# فحص البيانات
npm run check-city-data
npm run check-sheikh-data
```

### اختبار البريد الإلكتروني
```bash
# اختبار إرسال البريد
npm run test-email

# اختبار رموز الاستعادة
npm run test-email-code
```

### اختبار الصفحات
```bash
# اختبار جميع الصفحات
npm run test-pages
```

## 🔧 استكشاف الأخطاء

### مشاكل قاعدة البيانات
1. تحقق من `MONGODB_URI`
2. تأكد من تشغيل MongoDB
3. راجع Console للأخطاء
4. تحقق من صلاحيات المستخدم

### مشاكل البريد الإلكتروني
1. تحقق من إعدادات SMTP
2. تأكد من كلمة مرور التطبيق
3. راجع مجلد البريد المزعج
4. تحقق من حدود الإرسال

### مشاكل الأداء
1. تحقق من فهارس قاعدة البيانات
2. راجع حجم البيانات
3. تحقق من إعدادات الخادم
4. راجع استخدام الذاكرة

## 📈 المراقبة

### المقاييس المهمة
- عدد المستخدمين النشطين
- معدل نجاح تسجيل الدخول
- وقت استجابة قاعدة البيانات
- معدل نجاح إرسال البريد

### التنبيهات
- فشل الاتصال بقاعدة البيانات
- فشل إرسال البريد الإلكتروني
- محاولات تسجيل دخول فاشلة
- أخطاء النظام

## 🤝 المساهمة

### إرشادات التطوير
1. لا تستخدم بيانات وهمية
2. تأكد من عمل قاعدة البيانات
3. اتبع معايير الأمان
4. اختبر التغييرات جيداً

### الإبلاغ عن الأخطاء
1. وصف واضح للمشكلة
2. خطوات إعادة الإنتاج
3. رسائل الخطأ
4. معلومات النظام

## 📄 الترخيص

هذا المشروع مرخص تحت رخصة MIT. راجع ملف `LICENSE` للتفاصيل.

## 📞 الدعم

للحصول على الدعم أو الإبلاغ عن المشاكل:
- إنشاء Issue في GitHub
- التواصل عبر البريد الإلكتروني
- مراجعة الوثائق

---

## ⚠️ ملاحظة مهمة

**هذا النظام يعمل 100% مع قاعدة البيانات الحقيقية. لا توجد بيانات وهمية أو للتجربة. تأكد من إعداد قاعدة البيانات قبل تشغيل النظام.**

🎉 **النظام جاهز للإنتاج!**
