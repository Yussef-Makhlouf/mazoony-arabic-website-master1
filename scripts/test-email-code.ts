#!/usr/bin/env ts-node

// Script ูุงุฎุชุจุงุฑ ุฅุฑุณุงู ุฑูุฒ ุงุณุชุนุงุฏุฉ ูููุฉ ุงููุฑูุฑ ุงูุฌุฏูุฏ
import { EmailService } from '../lib/email';

async function testPasswordResetEmail() {
  console.log('๐งช ุงุฎุชุจุงุฑ ุฅุฑุณุงู ุฑูุฒ ุงุณุชุนุงุฏุฉ ูููุฉ ุงููุฑูุฑ ุงูุฌุฏูุฏ...\n');

  // ุฅูุดุงุก ุฑูุฒ ุชุฌุฑูุจู
  const testCode = 'ABC123';
  const testEmail = 'test@example.com';
  const testUserName = 'ุงููุณุชุฎุฏู ุงูุชุฌุฑูุจู';

  try {
    console.log('๐ง ุฅุฑุณุงู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู...');
    console.log(`   ุงูุจุฑูุฏ: ${testEmail}`);
    console.log(`   ุงูุฑูุฒ: ${testCode}`);
    console.log(`   ุงููุณุชุฎุฏู: ${testUserName}\n`);

    // ุงุฎุชุจุงุฑ ุฅุฑุณุงู ุงูุจุฑูุฏ
    const result = await EmailService.sendPasswordResetEmail(testEmail, testCode, testUserName);
    
    if (result.success) {
      console.log('โ ุชู ุฅุฑุณุงู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุจูุฌุงุญ!');
      console.log(`   ID ุงูุฑุณุงูุฉ: ${result.messageId}`);
    } else {
      console.log('โ ูุดู ูู ุฅุฑุณุงู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู');
    }

  } catch (error: any) {
    console.error('โ ุฎุทุฃ ูู ุฅุฑุณุงู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู:', error.message);
    
    // ุงุฎุชุจุงุฑ ุงูุงุชุตุงู
    console.log('\n๐ ุงุฎุชุจุงุฑ ุฅุนุฏุงุฏุงุช SMTP...');
    try {
      const connectionTest = await EmailService.testConnection();
      if (connectionTest) {
        console.log('โ ุฅุนุฏุงุฏุงุช SMTP ุตุญูุญุฉ');
      } else {
        console.log('โ ูุดููุฉ ูู ุฅุนุฏุงุฏุงุช SMTP');
      }
    } catch (connError: any) {
      console.error('โ ุฎุทุฃ ูู ุงูุงุชุตุงู:', connError.message);
    }
  }

  console.log('\n๐ ูุซุงู ุนูู ูุญุชูู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู:');
  console.log('โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ');
  console.log(`
ููุถูุน ุงูุจุฑูุฏ: ุฑูุฒ ุงุณุชุนุงุฏุฉ ูููุฉ ุงููุฑูุฑ - ูููุน ูุฃุฐููู

ูุฑุญุจุงู ${testUserName},

ุชููููุง ุทูุจุงู ูุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ ุงูุฎุงุตุฉ ุจุญุณุงุจู ูู ูููุน ูุฃุฐููู.

ุฑูุฒ ุงุณุชุนุงุฏุฉ ูููุฉ ุงููุฑูุฑ ูู: ${testCode}

ูุฑุฌู ุงุณุชุฎุฏุงู ูุฐุง ุงูุฑูุฒ ูู ุตูุญุฉ ุงุณุชุนุงุฏุฉ ูููุฉ ุงููุฑูุฑ ูู ุงููููุน.

ูุฐุง ุงูุฑูุฒ ุตุงูุญ ููุฏุฉ 15 ุฏูููุฉ ููุท.

ุฅุฐุง ูู ุชุทูุจ ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑุ ูุฑุฌู ุชุฌุงูู ูุฐู ุงูุฑุณุงูุฉ.

ูููุน ูุฃุฐููู
  `);
  console.log('โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ');
}

// ุชุดุบูู ุงูุงุฎุชุจุงุฑ
testPasswordResetEmail().catch(console.error);
